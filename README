Rewriting this in a decent enough way, just for fun.